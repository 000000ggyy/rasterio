

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Switching from GDAL’s Python bindings &mdash; rasterio 1.0.dev1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="rasterio 1.0.dev1 documentation" href="index.html"/>
        <link rel="next" title="Color" href="topics/color.html"/>
        <link rel="prev" title="Quickstart" href="quickstart.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> rasterio
          

          
          </a>

          
            
            
              <div class="version">
                1.0.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Switching from GDAL&#8217;s Python bindings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mutual-incompatibility">Mutual Incompatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-gdal-environment">The GDAL Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading">Reading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing">Writing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="topics/color.html">Color</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/concurrency.html">Concurrent processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/errors.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/features.html">Vector Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/fillnodata.html">Filling nodata areas</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/georeferencing.html">Georeferencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/image_options.html">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/image_processing.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/masking-by-shapefile.html">Masking a raster using a shapefile</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/masks.html">Nodata Masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/migrating-to-v1.html">Migrating to Rasterio 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/overviews.html">Overviews</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/reproject.html">Reprojection</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/resampling.html">Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/tags.html">Tagging datasets and bands</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/vsi.html">Virtual Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/windowed-rw.html">Windowed reading and writing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">rasterio package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Users Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">rasterio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Switching from GDAL&#8217;s Python bindings</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/switch.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="switching-from-gdal-s-python-bindings">
<h1>Switching from GDAL&#8217;s Python bindings<a class="headerlink" href="#switching-from-gdal-s-python-bindings" title="Permalink to this headline">¶</a></h1>
<p>Switching from GDAL&#8217;s Python bindings to Rasterio for new projects or new
iterations on existing projects may not be complicated. This document explains
the key similarities and differences between these two Python packages and
provides some guidelines for why and how to switch.</p>
<div class="section" id="mutual-incompatibility">
<h2>Mutual Incompatibility<a class="headerlink" href="#mutual-incompatibility" title="Permalink to this headline">¶</a></h2>
<p>GDAL&#8217;s Python module, meaning the <code class="docutils literal"><span class="pre">gdal</span></code> module in the <code class="docutils literal"><span class="pre">osgeo</span></code> namespace,
and Rasterio are mutually incompatible and should not be imported and used in
a single Python program. The reason is that they take different, naive,
incompatible approaches to managing global variables in the dynamic library
that they would share. It is assumed in multiple places in <code class="docutils literal"><span class="pre">gdal</span></code>, such as
testing whether the count of currently registered format drivers is 0 to
determine whether any drivers need to be registered, that no other Python
module functions are modifying the variables in the dynamic library. Rasterio
makes the same kind of assumptions and consequently the state of the global
GDAL driver manager may be unpredictable. Additionally, <code class="docutils literal"><span class="pre">gdal</span></code> and Rasterio
register conflicting error handlers and thus the propagation of exceptions and
warnings may depend on which module was imported last.</p>
<p>Beyond the issues above, the modules have different styles and don&#8217;t complement
each other well. The bottom line: choose <code class="docutils literal"><span class="pre">import</span> <span class="pre">osgeo.gdal</span></code> or <code class="docutils literal"><span class="pre">import</span>
<span class="pre">rasterio</span></code>.</p>
</div>
<div class="section" id="the-gdal-environment">
<h2>The GDAL Environment<a class="headerlink" href="#the-gdal-environment" title="Permalink to this headline">¶</a></h2>
<p>GDAL library functions are excuted in a context of format drivers, error
handlers, and format-specific configuration options that this document will
call the &#8220;GDAL Environment.&#8221; With <code class="docutils literal"><span class="pre">gdal</span></code>, this context is initialized upon
import of the module. This makes sense because <code class="docutils literal"><span class="pre">gdal</span></code> objects are thin
wrappers around functions and classes in the GDAL dynamic library that
generally require registration of drivers and error handlers.  The <code class="docutils literal"><span class="pre">gdal</span></code>
module doesn&#8217;t have an abstraction for the environment, but it can be modified
using functions like <code class="docutils literal"><span class="pre">gdal.SetErrorHandler()</span></code> and <code class="docutils literal"><span class="pre">gdal.UseExceptions()</span></code>.</p>
<p>Rasterio has modules that don&#8217;t require complete initialization and
configuration of GDAL (<code class="docutils literal"><span class="pre">rasterio.dtypes</span></code>, <code class="docutils literal"><span class="pre">rasterio.profiles</span></code>, and
<code class="docutils literal"><span class="pre">rasterio.windows</span></code>, for example) and in the interest of reducing overhead
doesn&#8217;t register format drivers and error handlers until they are needed. The
functions that do need fully initialized GDAL environments will ensure that
they exist. <code class="docutils literal"><span class="pre">rasterio.open()</span></code> is the foremost of this category of functions.
Consider the example code below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="c1"># The GDAL environment has no registered format drivers or error</span>
<span class="c1"># handlers at this point.</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;example.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="c1"># Format drivers and error handlers are registered just before</span>
    <span class="c1"># open() executes.</span>
</pre></div>
</div>
<p>Importing <code class="docutils literal"><span class="pre">rasterio</span></code> does not initialize the GDAL environment. Calling
<code class="docutils literal"><span class="pre">rasterio.open()</span></code> does. This is different from <code class="docutils literal"><span class="pre">gdal</span></code> where <code class="docutils literal"><span class="pre">import</span>
<span class="pre">osgeo.gdal</span></code>, not <code class="docutils literal"><span class="pre">osgeo.gdal.Open()</span></code>, initializes the GDAL environment.</p>
<p>Rasterio has an abstraction for the GDAL environment, <code class="docutils literal"><span class="pre">rasterio.Env</span></code>, that
can be invoked explicitly for more control over the configuration of GDAL as
shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="c1"># The GDAL environment has no registered format drivers or error</span>
<span class="c1"># handlers at this point.</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">CPL_DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">GDAL_CACHEMAX</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="c1"># This ensures that all drivers are registered in the global</span>
    <span class="c1"># context. Within this block *only* GDAL&#39;s debugging messages</span>
    <span class="c1"># are turned on and the raster block cache size is set to 512MB.</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;example.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="c1"># Perform GDAL operations in this context.</span>
        <span class="c1"># ...</span>
        <span class="c1"># Done.</span>

<span class="c1"># At this point, configuration options are set back to their</span>
<span class="c1"># previous (possibly unset) values. The raster block cache size</span>
<span class="c1"># is returned to its default (5% of available RAM) and debugging</span>
<span class="c1"># messages are disabled.</span>
</pre></div>
</div>
<p>As mentioned previously, <code class="docutils literal"><span class="pre">gdal</span></code> has no such abstraction for the GDAL
environment. The nearest approximation would be something like the code
below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="c1"># Define a new configuration, save the previous configuration,</span>
<span class="c1"># and then apply the new one.</span>
<span class="n">new_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;CPL_DEBUG&#39;</span><span class="p">:</span> <span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;GDAL_CACHEMAX&#39;</span><span class="p">:</span> <span class="s1">&#39;512&#39;</span><span class="p">}</span>
<span class="n">prev_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_config</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">SetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<span class="c1"># Perform GDAL operations in this context.</span>
<span class="c1"># ...</span>
<span class="c1"># Done.</span>

<span class="c1"># Restore previous configuration.</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">prev_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">SetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>Rasterio provides this with a single Python statement.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">CPL_DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">GDAL_CACHEMAX</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="reading">
<h2>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll start with a raster dataset to work with, our trusty test fixture</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">raster</span> <span class="o">=</span> <span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span>
</pre></div>
</div>
<img alt="_images/rgb.jpg" src="_images/rgb.jpg" />
<p>The most basic operation is reading the raster into a numpy array</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># osgeo.gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo.gdalconst</span> <span class="kn">import</span> <span class="n">GA_ReadOnly</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">GA_ReadOnly</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">g_ds</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Cannot open </span><span class="si">%r</span><span class="s2"> as GDAL raster&quot;</span> <span class="o">%</span> <span class="n">raster</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_arr</span> <span class="o">=</span> <span class="n">g_ds</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
</pre></div>
</div>
<p>The similar operation in rasterio</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># rasterio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is the same 3D <code class="docutils literal"><span class="pre">numpy.ndarray</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r_arr</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 718, 791)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">g_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="p">)</span>
</pre></div>
</div>
<p>If we want to grab a subset of the raster, say from row 300 to 400 and column 200 to 400.
In gdal you would express this in terms of the offset (200, 300) and size (200, 100)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># osgeo.gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_arr2</span> <span class="o">=</span> <span class="n">g_ds</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_arr2</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 100, 200)</span>
</pre></div>
</div>
<p>In Rasterio, we use a windows tuple which explicitly defines the start/stop row and columns</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># rasterio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r_arr2</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="p">((</span><span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">r_arr2</span><span class="p">,</span> <span class="n">g_arr2</span><span class="p">)</span>
</pre></div>
</div>
<p>Reading a single band into a 2D array follows a different pattern. In gdal, you get a
reference to a <code class="docutils literal"><span class="pre">RasterBand</span></code> and use its <code class="docutils literal"><span class="pre">ReadAsArray</span></code> method</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># osgeo.gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_band1</span> <span class="o">=</span> <span class="n">g_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_band1_arr</span> <span class="o">=</span> <span class="n">g_band1</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g_band1_arr</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(718, 791)</span>
</pre></div>
</div>
<p>With Rasterio, you pass the raster band index to the <code class="docutils literal"><span class="pre">read()</span></code> method. Note that
both Rasterio and gdal use a 1-based index to defined bands</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># rasterio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r_band1_arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">r_band1_arr</span><span class="p">,</span> <span class="n">g_band1_arr</span><span class="p">)</span>
</pre></div>
</div>
<p>With the gdal objects you have to manually manage the object&#8217;s lifecycle</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># osgeo.gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># clean up reference to dateset to close</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">g_band1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">g_ds</span>
</pre></div>
</div>
<div class="section" id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s take the arrays that we&#8217;ve read from the original dataset and write them out
to a new GeoTIFF file.</p>
<p>With Rasterio, you open the dataset, read the data and the
<code class="docutils literal"><span class="pre">profile</span></code> which contains the metadata necessary to write a similar dataset.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>   <span class="o">&gt;&gt;&gt;</span> <span class="c1"># rasterio</span>
   <span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
   <span class="o">...</span>     <span class="n">arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
   <span class="o">...</span>     <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
   <span class="o">&gt;&gt;&gt;</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
   <span class="p">(</span><span class="mi">718</span><span class="p">,</span> <span class="mi">791</span><span class="p">)</span>

<span class="n">Writing</span> <span class="n">the</span> <span class="mi">3</span><span class="n">D</span> <span class="n">array</span> <span class="k">with</span> <span class="n">Rasterio</span> <span class="ow">is</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">Python</span><span class="s1">&#39;s file interface</span>
<span class="k">with</span> <span class="n">some</span> <span class="n">additional</span> <span class="n">metadata</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">geospatial</span> <span class="n">datasets</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>   <span class="o">&gt;&gt;&gt;</span> <span class="c1"># rasterio</span>
   <span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/tmp/newraster.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
   <span class="o">...</span>     <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>


<span class="n">The</span> <span class="n">equivalent</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">osgeo</span><span class="o">.</span><span class="n">gdal</span> <span class="n">requires</span> <span class="n">a</span> <span class="n">more</span> <span class="n">procedural</span> <span class="n">approach</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out_raster</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s1">&#39;/tmp/newraster_gdal.tif&#39;</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
<span class="gp">... </span>                           <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out_raster</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">())</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">bidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">band</span> <span class="o">=</span> <span class="n">out_raster</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">bidx</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">bidx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">band</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
<span class="go">0</span>
<span class="go">0</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">srs</span><span class="o">.</span><span class="n">ImportFromWkt</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wkt</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out_raster</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out_raster</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
</pre></div>
</div>
<p>For a real-world example of a Python project making the osgeo.gdal-to-rasterio switch,
see the pull request for the <a class="reference external" href="https://github.com/perrygeo/python-rasterstats/pull/63">rasterstats migration</a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="topics/color.html" class="btn btn-neutral float-right" title="Color" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quickstart" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mapbox.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>